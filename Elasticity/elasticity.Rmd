---
title: "Price Elasticity"
author: "Wei Xie"
date: "10/24/2018"
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

In this study, we follow the ideas in a recent [blog on price elasticity modeling](https://towardsdatascience.com/calculating-price-elasticity-of-demand-statistical-modeling-with-python-6adb2fa7824d). We will use R to build a regression model to estimate the price elasticity.


# Data Analysis

## Data Preparation

```{r libs,results="markdown", message=FALSE, warning=FALSE, echo=TRUE}
library(tidyverse)
library(gridExtra)
library(lubridate)
library(broom)
```

The data set of this analysis can be downloaded from [here](https://raw.githubusercontent.com/susanli2016/Machine-Learning-with-Python/master/beef.csv).

```{r dat, results="markdown", message=FALSE, warning=FALSE, echo=TRUE}
df <- read_csv("beef.csv")
df
```

The data set is the quarterly beef sale and price from 1Q1977 to 3Q1999. Therefore, let's visualize the trend.

```{r ts-view, results="markdown", message=FALSE, warning=FALSE, echo=TRUE}
df %>% 
  mutate(date=make_date(Year, (Quarter-1)*3+1, 1)) %>%
  ggplot(aes(x=date, y=Quantity)) +
  geom_line() +
  labs(x="Date",y="Quantity") +
  theme(axis.text.x=element_text(angle=45,hjust=1)) -> p1

df %>% 
  mutate(date=make_date(Year, (Quarter-1)*3+1, 1)) %>%
  ggplot(aes(x=date, y=Price)) +
  geom_line() +
  labs(x="Date",y="Price") +
  theme(axis.text.x=element_text(angle=45,hjust=1)) -> p2

grid.arrange(p1,p2,ncol=1)
```

We can see that the price and quantity do change in opposite directions. For example, quantity sharply decreased from 1977 to 1980 as price increased rapidly in the same time.

## Analysis

Based on definition of economics, the elasticity is

$$
elasticity = \frac{\partial\log(d)}{\partial\log(P)}
$$

where $d$ is the demand and $P$ is the price. Therefore, we will produce a linear regression model on $\log(d)$ vs. $\log(P)$.

```{r log-lm,results="markdown",message=FALSE, warning=FALSE, echo=TRUE}
elast_lm <- lm(log(Quantity) ~ log(Price), data=df)
summary(elast_lm)

elast_val <- unlist(tidy(elast_lm)["2","estimate"])

elast_lm %>% augment() %>% 
  ggplot(aes(x=log.Price.)) +
  geom_point(aes(y=log.Quantity.), color="black") +
  geom_line(aes(y=.fitted), color="blue") +
  labs(x="log(Price)", y="log(Demand)") +
  guides(color=guide_legend(title="Key")) + 
  ggtitle("Elasticity of Beef")

paste("Elasticity = ", round(elast_val, digits=3))
```

The regression model return very good $R^2$ and the elasticity is `r round(elast_val,digits=3)`. Let's also review the residual graph to ensure the quality.

```{r resid, results="markdown", message=FALSE, warning=FALSE, echo=TRUE}
elast_lm %>% augment() %>%
  ggplot(aes(x=.fitted, y=.resid)) +
  geom_point() +
  labs(x="Fitted", y="Residuals") +
  ggtitle("Residuals vs. Fitted")
```

Overall, the points seem to distribute randomally, although there is clearly some inbalance between fitted value below and above 3.

# Conclusions

Overall, the beef's demand is fairly inelastic with regard to price as demand decreases more slowly than price. This could be that beef is a major source of protein intake for the region and it is relatively difficult to substitute it with another food.

